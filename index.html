<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
  const allImages = {
    AGATHA: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/AGATHA.png',
    DAYANNE: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/DAYANNE.jpg',
    LEANDRO: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/LEANDRO.png',
    LOLA: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/LOLA.jpeg',
    AMORA: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/AMORA.jpeg',
    MIGUEL: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/MIGUEL.jpeg',
    FEFE: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/FEFE.jpeg',
    MIA: 'https://raw.githubusercontent.com/lwcuiaba/jogo2/main/MIA.jpeg'
  };

  const fases = [
    [allImages.AGATHA, allImages.DAYANNE, allImages.LEANDRO],
    [allImages.AGATHA, allImages.DAYANNE, allImages.LEANDRO, allImages.LOLA, allImages.AMORA],
    Object.values(allImages)
  ];

  let faseAtual = 0;
  let cardsArray = [];
  let flippedCards = [];
  let matchedCount = 0;

  const game = document.getElementById('game');
  const matchSound = document.getElementById('match-sound');
  const failSound = document.getElementById('fail-sound');
  const winSound = document.getElementById('win-sound');
  const toggleBtn = document.getElementById('toggle-theme');
  const nextBtn = document.getElementById('next-phase');

  toggleBtn.onclick = () => document.body.classList.toggle('light');

  nextBtn.onclick = () => {
    if (faseAtual < fases.length - 1) {
      faseAtual++;
      iniciarFase();
    } else {
      alert("Você já está na última fase!");
    }
  };

  function shuffle(array) {
    for(let i = array.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function createCard(src, index) {
    const card = document.createElement('div');
    card.classList.add('card');
    card.dataset.image = src;
    card.dataset.index = index;

    card.innerHTML = `
      <div class="card-inner">
        <div class="card-front"></div>
        <div class="card-back"><img src="${src}" alt="imagem"/></div>
      </div>
    `;

    card.addEventListener('click', () => {
      if (flippedCards.length < 2 && !card.classList.contains('flipped')) {
        card.classList.add('flipped');
        flippedCards.push(card);
        if (flippedCards.length === 2) checkMatch();
      }
    });

    return card;
  }

  function fireSmallConfetti() {
    confetti({ particleCount: 60, spread: 50, origin: { y: 0.5 }, scalar: 0.6 });
  }

  function fireWinConfetti() {
    confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
  }

  function mostrarMensagemDeVitoria(texto) {
    const div = document.createElement('div');
    div.textContent = texto;
    div.style.position = 'fixed';
    div.style.top = '50%';
    div.style.left = '50%';
    div.style.transform = 'translate(-50%, -50%)';
    div.style.fontSize = '36px';
    div.style.background = 'rgba(0,0,0,0.8)';
    div.style.color = 'white';
    div.style.padding = '20px 40px';
    div.style.borderRadius = '16px';
    div.style.zIndex = '1000';
    document.body.appendChild(div);

    setTimeout(() => {
      div.remove();
    }, 2500);
  }

  function checkMatch() {
    const [card1, card2] = flippedCards;
    if (card1.dataset.image === card2.dataset.image) {
      card1.classList.add('matched');
      card2.classList.add('matched');
      matchSound.currentTime = 0;
      matchSound.play();
      fireSmallConfetti();
      flippedCards = [];
      matchedCount += 2;

      if (matchedCount === cardsArray.length) {
        winSound.play();
        fireWinConfetti();

        if (faseAtual < fases.length - 1) {
          mostrarMensagemDeVitoria("🎉 Fase Concluída!");
          setTimeout(() => {
            faseAtual++;
            iniciarFase();
          }, 3000);
        } else {
          mostrarMensagemDeVitoria("🏁 Você venceu todas as fases!");
        }
      }
    } else {
      card1.classList.add('wrong');
      card2.classList.add('wrong');
      failSound.currentTime = 0;
      failSound.play();
      setTimeout(() => {
        card1.classList.remove('flipped', 'wrong');
        card2.classList.remove('flipped', 'wrong');
        flippedCards = [];
      }, 800);
    }
  }

  function iniciarFase() {
    matchedCount = 0;
    flippedCards = [];
    game.innerHTML = '';
    const imagensDaFase = fases[faseAtual];
    cardsArray = shuffle([...imagensDaFase, ...imagensDaFase]);
    cardsArray.forEach((img, i) => {
      const carta = createCard(img, i);
      game.appendChild(carta);
    });
  }

  iniciarFase();
</script>
